# IMG-Quest 仕様（v0.1）

## 1. 解決したいこと
導入時のFI設定は、IMG項目の網羅だけでは不十分で、
- 要件 → 設定 → 例外運用 → テスト/移行
の“つながり”を意思決定できないと手戻りが増える。

IMG-Questは、SAP画面の模倣ではなく、**導入に必要な意思決定を辿る体験**を提供する。

## 2. コア価値（MVPの核）
1. **スコープ質問ウィザード**
2. **設定カタログ（Config Catalogue）**
3. **依存関係エンジン**（回答から必要設定を自動展開）
4. **成果物ジェネレータ**（決定事項・設定一覧・テスト観点・移行観点をMD出力）

## 3. ユースケース
### 3.1 新規プロジェクト作成
- 国/地域（税制）、業種、会社数、通貨、締め運用を入力
- その場で「必要な論点」を自動生成

### 3.2 ウィザードで要件回答
- 例：請求締め（都度/締め）、支払条件、消込単位、税、外貨、締め日数など

### 3.3 設定バックログ確認
- 依存関係グラフで“先に決めるべきもの”がわかる
- 未決があると成果物が「未確定」として出力される（推測しない）

### 3.4 成果物エクスポート
- `Decision Log`（決定事項）
- `Config Workbook`（必要設定一覧）
- `Test View`（最低限のテスト観点）
- `Migration View`（移行オブジェクト一覧）

## 4. ドメイン設計（概念モデル）
### 主要エンティティ
- `Project`
- `Question` / `Answer`
- `Decision`（決定事項：根拠・ステータス）
- `ConfigItem`（設定項目：ID、説明、依存、推奨、影響範囲）
- `BacklogItem`（ConfigItemのプロジェクト適用版）
- `Artifact`（出力物：MD/JSON、将来的にXLSX）

### ConfigItemの最小スキーマ（案）
```json
{
  "id": "FI-CORE-001",
  "title": "会計年度バリアント",
  "description": "会計年度/期間の定義。締め運用・移行・採番に影響",
  "inputs": [{"name":"fiscal_year_variant","type":"select","options":["K4","V3","CUSTOM"]}],
  "depends_on": [],
  "produces": ["DECISION_LOG", "CONFIG_WORKBOOK", "TEST_VIEW", "MIGRATION_VIEW"],
  "priority": "P0",
  "notes": ["未決だと以降の期間関連設定が確定できない"]
}
```

## 5. 依存関係エンジン（ルール）
- 回答 → ConfigItemを有効化（enable/disable）
- `depends_on` により前提未決ならブロック（もしくは警告）
- “推測出力禁止”
  - 未決は `TBD` として成果物に残す
  - ただし「次に決めるべき質問」を提示する

## 6. FI（MVP）対象カタログ範囲
### P0（最優先）
- 組織: 会社コード、通貨、会計年度、期間
- 転記: 伝票タイプ、採番、期間オープン
- マスタ: 勘定科目（BS/PL、オープンアイテム）
- AP/AR最小: BP方針、統制勘定、支払条件、支払方法、消込単位

### P1
- 税コード、端数差額、支払/入金差額
- 締め後運用（例外権限、ログ）
- 基本レポート（試算表、未消込）

## 7. LedgerForge との連携（将来オプション）
- IMG-Questは「意思決定・成果物生成」
- LedgerForgeは「会計処理エンジン」
- 連携案:
  - IMG-Questが決定した設定をJSONで出力
  - LedgerForgeに読み込ませ、疑似転記シミュレーターを提供

## 8. 技術スタック（推奨）
- Frontend: **Next.js + React**
- Backend: **FastAPI**
- DB: PostgreSQL（or SQLiteでMVP開始）
- Auth（後回し）: 初期はローカルプロジェクト保存でOK

## 9. Doneの定義（MVP）
- 10〜20問のウィザードでFIコアの論点が一周する
- 回答から必要設定がバックログ化され、依存関係と優先度が表示される
- MD成果物が生成できる（未決はTBD）
- “次に決めるべきこと”が明示される
